# NocoBase 需求说明书

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | NocoBase 需求说明书 |
| 版本 | 1.0.0 |
| 编写日期 | 2026-01-06 |
| 项目名称 | NocoBase 无代码开发平台 |
| 文档状态 | 正式发布 |

---

## 1. 项目概述

### 1.1 项目背景

NocoBase 是一个开源的无代码开发平台，旨在帮助企业和开发者快速构建业务应用，无需编写传统代码。通过可视化的界面配置和强大的插件系统，用户可以灵活地创建数据模型、设计界面、定义工作流，并将 AI 能力集成到业务系统中。

### 1.2 项目目标

1. **降低开发门槛**: 让非技术人员也能构建复杂的企业应用
2. **提高开发效率**: 相比传统开发，开发效率提升 10-50 倍
3. **保证系统扩展性**: 通过插件系统实现无限扩展能力
4. **支持 AI 集成**: 将 AI 能力无缝融入业务流程
5. **数据模型驱动**: 解耦数据结构与界面，实现真正的灵活性

### 1.3 目标用户

| 用户类型 | 描述 | 主要需求 |
|---------|------|---------|
| **业务人员** | 企业业务专家，无编程背景 | 快速构建业务应用，无需依赖 IT 部门 |
| **低代码开发者** | 有一定技术背景的开发者 | 通过配置和少量代码实现复杂功能 |
| **专业开发者** | 全栈工程师，需要深度定制 | 完整的 API 和插件系统支持深度扩展 |
| **系统管理员** | 负责 IT 基础设施管理 | 部署、维护、监控和安全管理 |

---

## 2. 功能性需求

### 2.1 核心功能模块

#### 2.1.1 数据模型管理

**需求描述**: 系统必须提供可视化的数据模型设计能力，支持用户定义数据结构。

**功能要求**:

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|-------|
| F-001 | 创建数据表 | 通过可视化界面创建数据库表，定义字段类型和属性 | P0 |
| F-002 | 字段类型支持 | 支持字符串、数字、日期、布尔、JSON、文件等基础类型 | P0 |
| F-003 | 关系定义 | 支持一对一、一对多、多对多关系配置 | P0 |
| F-004 | 字段校验 | 支持必填、唯一、正则表达式等校验规则 | P1 |
| F-005 | 默认值设置 | 支持静态值和动态表达式作为字段默认值 | P1 |
| F-006 | 索引管理 | 支持为字段添加索引以优化查询性能 | P2 |
| F-007 | 外部数据源 | 支持连接外部数据库作为数据源 | P1 |
| F-008 | API 数据源 | 支持 REST API 作为数据源 | P2 |

**验收标准**:
- 用户可以在 5 分钟内完成一个包含 10 个字段的数据表创建
- 支持至少 15 种字段类型
- 关系配置支持级联删除和关联查询

#### 2.1.2 界面设计

**需求描述**: 提供 WYSIWYG（所见即所得）的界面设计器。

**功能要求**:

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|-------|
| F-009 | 页面管理 | 创建、编辑、删除应用页面 | P0 |
| F-010 | 区块布局 | 支持表格、表单、详情、日历、看板等区块类型 | P0 |
| F-011 | 字段配置 | 为每个区块配置显示的字段和顺序 | P0 |
| F-012 | 动作配置 | 添加自定义按钮和操作（如保存、删除、提交） | P0 |
| F-013 | 过滤器 | 为列表配置查询条件和过滤器 | P1 |
| F-014 | 表单验证 | 配置表单提交时的验证规则 | P1 |
| F-015 | 界面模板 | 提供预置的界面模板供快速开始 | P2 |
| F-016 | 响应式设计 | 支持移动端和桌面端的自适应布局 | P1 |

**验收标准**:
- 支持至少 10 种预置区块类型
- 拖拽式配置，无需编写代码
- 配置实时预览

#### 2.1.3 权限管理

**需求描述**: 提供细粒度的访问控制和权限管理。

**功能要求**:

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|-------|
| F-017 | 用户管理 | 用户账号的创建、编辑、删除、禁用 | P0 |
| F-018 | 角色管理 | 创建角色并分配权限 | P0 |
| F-019 | 资源权限 | 控制用户对数据资源的访问权限 | P0 |
| F-020 | 操作权限 | 控制用户可以执行的操作（CRUD） | P0 |
| F-021 | 字段权限 | 控制用户可以查看/编辑的字段 | P1 |
| F-022 | 数据权限 | 基于条件的数据行级权限控制 | P1 |
| F-023 | 权限继承 | 角色权限的继承和组合机制 | P2 |
| F-024 | 操作日志 | 记录用户的敏感操作 | P1 |

**验收标准**:
- 支持角色-权限的灵活配置
- 支持数据行级别的权限控制
- 权限验证在 50ms 内完成

#### 2.1.4 工作流引擎

**需求描述**: 提供可视化的工作流设计能力，支持复杂的业务流程自动化。

**功能要求**:

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|-------|
| F-025 | 流程设计 | 可视化的流程设计器 | P0 |
| F-026 | 触发器 | 支持定时、事件触发、手动触发 | P0 |
| F-027 | 条件分支 | 支持基于数据的条件判断 | P0 |
| F-028 | 循环处理 | 支持对数据集合的循环处理 | P1 |
| F-029 | 并行处理 | 支持并行分支和合并 | P1 |
| F-030 | 数据操作 | 支持创建、更新、删除数据 | P0 |
| F-031 | 消息通知 | 支持邮件、短信、Webhook 通知 | P1 |
| F-032 | AI 集成 | 集成 AI 进行数据处理和决策 | P2 |

**验收标准**:
- 支持至少 10 种预置节点类型
- 流程执行可追溯和调试
- 支持流程版本管理

#### 2.1.5 AI 集成

**需求描述**: 将 AI 能力无缝集成到业务系统中。

**功能要求**:

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|-------|
| F-033 | AI 助手配置 | 配置 AI 角色、Prompt 和上下文 | P0 |
| F-034 | AI 动作 | 在工作流中调用 AI 处理数据 | P0 |
| F-035 | AI 字段 | 在表单中集成 AI 辅助输入 | P1 |
| F-036 | 多模型支持 | 支持多种 AI 模型（OpenAI、本地模型） | P1 |
| F-037 | 上下文管理 | 为 AI 提供业务数据和上下文 | P0 |

**验收标准**:
- 支持主流 AI 模型（OpenAI、Claude 等）
- AI 响应时间 < 5 秒
- 支持 AI 使用的安全审计

#### 2.1.6 插件系统

**需求描述**: 提供完整的插件开发和管理能力。

**功能要求**:

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|-------|
| F-038 | 插件管理 | 插件的安装、卸载、启用、禁用 | P0 |
| F-039 | 插件市场 | 官方插件市场，提供预置插件 | P1 |
| F-040 | 插件开发 SDK | 完整的插件开发工具和文档 | P0 |
| F-041 | 插件依赖管理 | 自动解析和处理插件依赖关系 | P0 |
| F-042 | 插件生命周期 | 支持 beforeLoad/Load/afterLoad 钩子 | P0 |
| F-043 | 插件热加载 | 支持运行时加载/卸载插件 | P1 |

**验收标准**:
- 提供至少 20 个官方插件
- 插件开发文档完整
- 支持插件的热加载

#### 2.1.7 API 接口

**需求描述**: 自动生成 RESTful API 接口。

**功能要求**:

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|-------|
| F-044 | CRUD API | 自动为数据表生成增删改查接口 | P0 |
| F-045 | 关联查询 | 支持关联数据的查询接口 | P0 |
| F-046 | 过滤排序 | 支持查询参数的过滤和排序 | P0 |
| F-047 | 分页查询 | 支持分页参数和游标分页 | P0 |
| F-048 | 自定义接口 | 支持用户自定义 API 接口 | P1 |
| F-049 | API 文档 | 自动生成 API 文档（Swagger/OpenAPI） | P2 |
| F-050 | API 认证 | 基于 Token 的 API 访问认证 | P0 |

**验收标准**:
- 自动生成的 API 符合 RESTful 规范
- API 响应时间 < 200ms（简单查询）
- 支持 GraphQL 查询（可选）

---

### 2.2 系统管理功能

#### 2.2.1 用户认证

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|-------|
| F-051 | 用户登录 | 支持用户名/密码、手机号、邮箱登录 | P0 |
| F-052 | 多因素认证 | 支持 2FA 双因素认证 | P1 |
| F-053 | 第三方登录 | 支持 OAuth、LDAP、SAML 集成 | P1 |
| F-054 | 密码策略 | 支持密码复杂度要求和过期策略 | P1 |
| F-055 | 会话管理 | 支持多设备登录和会话控制 | P1 |

#### 2.2.2 系统配置

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|-------|
| F-056 | 基础配置 | 系统名称、Logo、主题色配置 | P0 |
| F-057 | 邮件配置 | SMTP 邮件服务器配置 | P0 |
| F-058 | 短信配置 | 短信服务提供商配置 | P1 |
| F-059 | 存储配置 | 文件存储（本地/OSS/S3）配置 | P0 |
| F-060 | 环境变量 | 支持通过环境变量配置系统 | P0 |

#### 2.2.3 日志和监控

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|-------|
| F-061 | 操作日志 | 记录用户操作和系统事件 | P1 |
| F-062 | 错误日志 | 记录系统错误和异常 | P1 |
| F-063 | 性能监控 | 监控系统性能指标 | P2 |
| F-064 | 日志导出 | 支持日志的导出和分析 | P2 |

---

## 3. 非功能性需求

### 3.1 性能需求

| 指标 | 要求 | 备注 |
|------|------|------|
| **页面加载时间** | < 2 秒 | 首页加载 |
| **API 响应时间** | < 200ms | 简单查询 |
| **API 响应时间** | < 1 秒 | 复杂查询（含关联） |
| **并发用户数** | > 1000 | 同时在线用户 |
| **数据库查询** | < 100ms | 单表查询，100万数据量 |
| **工作流执行** | < 5 秒 | 简单流程（5个节点） |

### 3.2 可用性需求

| 指标 | 要求 | 备注 |
|------|------|------|
| **系统可用性** | ≥ 99.5% | 年度 |
| **故障恢复时间** | < 1 小时 | 严重故障 |
| **数据备份** | 每日备份 | 支持手动备份 |
| **数据恢复** | < 2 小时 | 从备份恢复 |

### 3.3 安全性需求

| 类别 | 要求 |
|------|------|
| **认证** | JWT Token 认证，Token 有效期可配置 |
| **密码加密** | bcrypt 加密，salt 轮次 ≥ 10 |
| **数据传输** | HTTPS 加密传输 |
| **SQL 注入防护** | 使用 ORM 参数化查询，自动防护 |
| **XSS 防护** | 输入过滤和输出转义 |
| **CSRF 防护** | CSRF Token 验证 |
| **审计日志** | 记录所有敏感操作 |
| **数据隔离** | 多租户数据隔离 |

### 3.4 兼容性需求

| 类别 | 要求 |
|------|------|
| **浏览器** | Chrome 90+, Firefox 88+, Safari 14+, Edge 90+ |
| **移动端** | iOS 14+, Android 10+ |
| **数据库** | PostgreSQL 12+, MySQL 8+, SQLite 3 |
| **Node.js** | ≥ 18.0.0 |
| **部署环境** | Docker, Linux, macOS |

### 3.5 可扩展性需求

| 类别 | 要求 |
|------|------|
| **插件系统** | 支持插件扩展所有核心功能 |
| **API 扩展** | 支持自定义 API 接口 |
| **UI 扩展** | 支持自定义区块和组件 |
| **数据源扩展** | 支持自定义数据源适配器 |
| **水平扩展** | 支持多实例部署（通过 Redis 共享状态） |

### 3.6 可维护性需求

| 类别 | 要求 |
|------|------|
| **代码规范** | ESLint + Prettier 代码格式化 |
| **类型检查** | TypeScript 严格模式 |
| **单元测试** | 核心模块测试覆盖率 ≥ 70% |
| **文档** | API 文档、开发者文档完整 |
| **版本管理** | 语义化版本控制 |

---

## 4. 系统架构需求

### 4.1 技术栈要求

#### 4.1.1 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| React | ≥ 18.0 | UI 框架 |
| Ant Design | ≥ 5.0 | UI 组件库 |
| Formily | ≥ 1.0 | 表单解决方案 |
| React Router | ≥ 6.0 | 路由管理 |
| Axios | - | HTTP 客户端 |
| dayjs | - | 日期处理 |

#### 4.1.2 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Node.js | ≥ 18.0 | 运行时环境 |
| Koa | ≥ 2.0 | Web 框架 |
| Sequelize | ≥ 6.0 | ORM |
| PostgreSQL | ≥ 12 | 主数据库 |
| Redis | ≥ 6.0 | 缓存和会话 |
| JWT | - | 认证令牌 |

### 4.2 架构设计原则

1. **微内核架构**: 核心功能最小化，扩展功能通过插件实现
2. **前后端分离**: 前端和后端通过 REST API 通信
3. **分层架构**: 表现层、业务逻辑层、数据访问层分离
4. **依赖注入**: 使用服务容器管理依赖关系
5. **事件驱动**: 使用事件机制解耦模块间通信

### 4.3 数据库设计要求

1. **表命名**: 使用复数形式（如 `users`, `posts`）
2. **字段命名**: 使用蛇形命名法（如 `created_at`）
3. **主键**: 每个表必须有自增主键 `id`
4. **时间戳**: 包含 `created_at` 和 `updated_at` 字段
5. **软删除**: 支持 `deleted_at` 软删除
6. **索引**: 为外键和常用查询字段添加索引

---

## 5. 用户角色和用例

### 5.1 用户角色定义

#### 5.1.1 管理员 (Admin)

**描述**: 系统最高权限管理者，负责系统配置和用户管理。

**核心用例**:
- UC-001: 系统初始化配置
- UC-002: 用户账号管理
- UC-003: 角色权限配置
- UC-004: 插件管理
- UC-005: 系统监控和日志查看

#### 5.1.2 应用构建者 (Builder)

**描述**: 负责构建和配置应用的业务人员或低代码开发者。

**核心用例**:
- UC-006: 创建数据模型
- UC-007: 设计界面和页面
- UC-008: 配置工作流
- UC-009: 设置权限
- UC-010: 配置 AI 助手

#### 5.1.3 终端用户 (End User)

**描述**: 使用应用完成业务工作的普通用户。

**核心用例**:
- UC-011: 登录系统
- UC-012: 查看数据
- UC-013: 创建和编辑记录
- UC-014: 提交审批流程
- UC-015: 使用 AI 辅助功能

#### 5.1.4 开发者 (Developer)

**描述**: 开发插件和扩展功能的专业开发者。

**核心用例**:
- UC-016: 开发自定义插件
- UC-017: 调用 REST API
- UC-018: 自定义组件开发
- UC-019: 系统集成

### 5.2 核心用例描述

#### UC-006: 创建数据模型

**主要流程**:
1. 用户进入"数据表管理"页面
2. 点击"新建表"按钮
3. 输入表名称和描述
4. 添加字段，选择字段类型
5. 配置字段属性（必填、唯一、默认值等）
6. 配置表间关系
7. 保存配置
8. 系统自动创建数据库表和 API 接口

**备选流程**:
- 4a. 字段类型选择错误：返回修改
- 7a. 表名已存在：提示用户更换名称

#### UC-011: 用户登录

**主要流程**:
1. 用户打开登录页面
2. 输入用户名和密码
3. （可选）输入验证码
4. 点击登录按钮
5. 系统验证凭证
6. 验证成功，生成 JWT Token
7. 跳转到首页

**备选流程**:
- 5a. 凭证错误：提示"用户名或密码错误"
- 5b. 账号被禁用：提示"账号已被禁用，请联系管理员"

---

## 6. 约束条件

### 6.1 技术约束

- 必须使用 TypeScript 开发
- 必须遵循项目代码规范
- 数据库必须支持事务
- 必须支持 Docker 部署

### 6.2 业务约束

- 单表记录数建议不超过 1000 万（性能考虑）
- 文件上传大小限制 100MB
- 工作流嵌套深度不超过 5 层
- API 调用频率限制：每用户每分钟 100 次

### 6.3 法律合规

- 遵守 AGPL-3.0 开源协议
- 支持 GDPR 数据保护要求
- 支持数据本地化部署

---

## 7. 需求优先级定义

| 优先级 | 描述 | 示例 |
|--------|------|------|
| **P0** | 核心功能，必须实现 | 用户登录、数据表管理 |
| **P1** | 重要功能，尽快实现 | 权限管理、工作流 |
| **P2** | 增强功能，可以延后 | AI 集成、API 文档 |

---

## 8. 附录

### 8.1 术语表

| 术语 | 定义 |
|------|------|
| **数据表** | 数据库中的表，用于存储结构化数据 |
| **字段** | 数据表中的列，定义数据的属性 |
| **区块** | 界面中的可配置组件，如表格、表单等 |
| **插件** | 扩展系统功能的模块 |
| **工作流** | 定义业务流程的可视化配置 |
| **角色** | 权限的集合，分配给用户 |
| **权限** | 对资源的访问和操作能力 |

### 8.2 参考文档

- NocoBase 官方文档: https://docs.nocobase.com
- NocoBase GitHub: https://github.com/nocobase/nocobase
- React 官方文档: https://react.dev
- Ant Design 文档: https://ant.design

---

## 变更历史

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|---------|-------|
| 1.0.0 | 2026-01-06 | 初始版本 | - |

---

**文档结束**
